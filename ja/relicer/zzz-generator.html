<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="utf-8" />
    <title>ゼンゼロ ジェネレーター - Relicer</title>
    <meta
      name="description"
      content="Relicerのゼンゼロ（ゼンレスゾーンゼロ）のビルドカード作成補助ツール（日本語）"
    />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <script src="https://code.jquery.com/jquery-3.2.1.min.js"></script>
    <link rel="icon" href="/favicon.ico" />
    <link rel="stylesheet" href="/style.css" />
    <style>
      .generatorContent {
        margin: 0 3%;
        width: 94%;
        display: flex;
        color: var(--pColor);
      }
      .input-section {
        flex: 1;
        padding: 20px;
        display: inline-block;
      }
      @media screen and (max-width: 767px) {
        .selectSection {
          width: 90%;
        }
      }
      @media screen and (min-width: 768px) {
        .selectSection {
          width: 40%;
          display: inline-block;
          margin-right: 5%;
        }
      }

      .middle-section {
        margin-top: 40vh;
        width: 10%;
        text-align: center;
      }

      .arrow {
        font-size: 200%;
      }

      .output-section {
        flex: 1;
        padding: 20px;
        margin: 20px;
        height: 70vh;
        overflow-x: auto;
        overflow-y: auto;
        position: relative;
        border: 1px solid var(--pColor);
      }

      .searchable-select,
      .text-input,
      .number-input,
      .range-input {
        width: 80%;
        padding: 10px;
        margin-top: 10px;
        margin-bottom: 10px;
        border-radius: 0px;
        color: var(--pColor);
        border: 1px solid var(--pColor);
      }

      button {
        padding: 10px;
        margin-right: 10px;
        background-color: var(--linkColor);
        color: var(--bgColor);
        border: none;
        border-radius: 5px;
        cursor: pointer;
      }

      button:disabled {
        color: var(--bgColor);
        background-color: var(--bgColor);
        cursor: not-allowed;
      }

      button:active {
        background-color: var(--bgColor);
      }

      #copyButton {
        position: absolute;
        top: 10px;
        right: 10px;
        padding: 5px 10px;
        background-color: var(--linkColor);
        color: var(--bgColor);
        border: none;
        border-radius: 5px;
        cursor: pointer;
      }

      #copyButton:active {
        background-color: var(--bgColor);
      }

      .item-container {
        margin-bottom: 20px;
        padding-left: 10px;
        padding-top: 5px;
        padding-bottom: 5px;
        color: var(--pColor);
        background-color: var(--bgColor);
        border: 1px solid var(--pColor);
        border-radius: 5px;
      }

      select {
        color: var(--pColor);
        background-color: var(--bgColor);
        border: 1px solid var(--pColor);
        margin-left: 10px;
      }

      .field-set {
        margin-bottom: 10px;
      }

      .slider-container {
        margin: 5px 0;
      }
    </style>
  </head>

  <!-- Google tag (gtag.js) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-3SWSM9QNQJ"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag() {
      dataLayer.push(arguments);
    }
    gtag("js", new Date());
    gtag("config", "G-3SWSM9QNQJ");
  </script>
  <body>
    <div id="header"></div>
    <script>
      $(function () {
        $("#header").load("/header.html");
      });
    </script>
    <h1>Relicerゼンゼロデータジェネレーター</h1>
    <br />
    <br />
    <h2>
      ディスク6個・サブステ各4個をすべて入力してください<br />先行公開版では装備の欠けには対応できていません
    </h2>
    <p>
      ゼンゼロのビルドカード（/zzz-char）でUIDからのデータ取得ができるようになるまでの暫定措置として、手打ちのデータから作れるようにしました。
      要素をここに入力して生成・コピーし、Discordの入力欄にペーストしてください。
    </p>
    <div class="generatorContent">
      <div class="input-section">
        <p style="margin: 15px 0; padding: 0">選択肢は文字を入力すると絞り込みます</p>

        <div class="selectSection">
          <label for="select1">キャラ選択</label>
          <input list="options1" id="0" class="searchable-select" />
          <datalist id="options1">
            <option value="11号"></option>
            <option value="アンドー"></option>
            <option value="アンビー"></option>
            <option value="エレン"></option>
            <option value="カリン"></option>
            <option value="クレタ"></option>
            <option value="グレース"></option>
            <option value="ニコ"></option>
            <option value="パイパー"></option>
            <option value="ビリー"></option>
            <option value="ベン"></option>
            <option value="ライカン"></option>
            <option value="リナ"></option>
            <option value="ルーシー"></option>
            <option value="朱鳶"></option>
            <option value="猫又"></option>
            <option value="蒼角"></option>
            <option value="青衣"></option>
          </datalist>
        </div>

        <div class="selectSection">
          <label for="select2">音動機選択</label>
          <input list="options2" id="1" class="searchable-select" />
          <datalist id="options2">
            <option value="なんちゃってスターライトエンジン"></option>
            <option value="まな板の鯉"></option>
            <option value="キャノンローラー"></option>
            <option value="ゲームボール"></option>
            <option value="ザ・ボールト"></option>
            <option value="スターライトエンジン"></option>
            <option value="ストリートスター"></option>
            <option value="ディープシー・ビジター"></option>
            <option value="デマラ式電池Ⅱ型"></option>
            <option value="ドリルリグ-レッドシャフト"></option>
            <option value="ハウスキーパー"></option>
            <option value="ビガー・シリンダー"></option>
            <option value="ブリムストーン"></option>
            <option value="ホットスプリング"></option>
            <option value="ラビットチャージャー"></option>
            <option value="リボルバーローター"></option>
            <option value="双生の涙"></option>
            <option value="啜り泣くゆりかご"></option>
            <option value="密林の食いしん坊"></option>
            <option value="恥じらう悪面"></option>
            <option value="拘縛されし者"></option>
            <option value="正規版変身装置"></option>
            <option value="歳月の薄片"></option>
            <option value="燃獄ギア"></option>
            <option value="複合コンパイラ"></option>
            <option value="貴重な石化コア"></option>
            <option value="鋼の肉球"></option>
            <option value="電撃リップグロス"></option>
          </datalist>
        </div>

        <div class="selectSection">
          <label for="numberInput">キャラレベル</label>
          <input type="number" id="2" class="number-input" min="1" max="60" />
        </div>

        <div class="selectSection">
          <label for="numberInput">音動機レベル</label>
          <input type="number" id="3" class="number-input" min="1" max="60" />
        </div>

        <div class="selectSection">
          <div class="label-with-value">
            <label for="4">キャラ心象 <span id="4" class="value-display">0</span>/6</label>
          </div>
          <input
            type="range"
            id="4"
            class="range-input"
            min="0"
            max="6"
            value="0"
            oninput="updateRangeValue(this)"
          />
        </div>

        <div class="selectSection">
          <div class="label-with-value">
            <label for="5">音動機改造 <span id="5" class="value-display">1</span>/5</label>
          </div>
          <input
            type="range"
            id="5"
            class="range-input"
            min="1"
            max="5"
            value="1"
            oninput="updateRangeValue(this)"
          />
        </div>

        <div class="selectSection">
          <label for="textInput">プレイヤー名</label>
          <input type="text" id="6" class="text-input" />
        </div>

        <div class="selectSection">
          <label for="textInput">セット効果</label>
          <input type="text" id="7" class="text-input" placeholder="4 極地 / 2 ｳｯﾄﾞﾍﾟｯｶｰ" />
        </div>

        <div class="selectSection">
          <label for="numberInput">インターノット</label>
          <input type="number" id="8" class="number-input" min="1" max="60" />
        </div>

        <div class="selectSection">
          <label for="textInput">スキルレベル</label>
          <input type="text" id="9" class="text-input" value="非対応" disabled />
        </div>

        <p style="margin: 15px 0; padding: 0">
          以下は%付きの値でも値にパーセントを入力しないでください
        </p>
        <div class="selectSection">
          <label for="numberInput">総合HP</label>
          <input type="number" id="10" class="number-input" min="1" max="60" />
        </div>
        <div class="selectSection">
          <label for="numberInput">総合ATK</label>
          <input type="number" id="11" class="number-input" min="1" max="60" />
        </div>
        <div class="selectSection">
          <label for="numberInput">総合DEF</label>
          <input type="number" id="12" class="number-input" min="1" max="60" />
        </div>
        <div class="selectSection">
          <label for="numberInput">総合CR</label>
          <input type="number" id="13" class="number-input" min="1" max="60" />
        </div>
        <div class="selectSection">
          <label for="numberInput">総合CD</label>
          <input type="number" id="14" class="number-input" min="1" max="60" />
        </div>
        <div class="selectSection">
          <label for="numberInput">総合PEN%</label>
          <input type="number" id="15" class="number-input" min="1" max="60" />
        </div>
        <div class="selectSection">
          <label for="numberInput">総合PEN</label>
          <input type="number" id="16" class="number-input" min="1" max="60" />
        </div>

        <div id="itemContainer"></div>

        <div class="buttons">
          <button id="removeItemButton" onclick="removeItem()" disabled>ディスク減少</button>
          <button id="addItemButton" onclick="addItem()">ディスク増加</button>
        </div>
      </div>

      <div class="middle-section">
        <div class="arrow">→</div>
        <br />
        <button onclick="showResult()">生成</button>
      </div>

      <div class="output-section">
        <div id="result"></div>
        <button id="copyButton" onclick="copyResult()">コピー</button>
      </div>
    </div>
    <br />

    <div id="footer">
      <!-- ここにfooter.htmlが読み込まれる -->
    </div>

    <script>
      $(function () {
        $("#footer").load("/footer.html");
      });
    </script>

    <script>
      function updateRangeValue(slider) {
        const valueDisplay = document.getElementById(`${slider.id}`);
        valueDisplay.innerText = slider.value;
      }
      let itemCount = 0;
      const maxItems = 6;
      const minItems = 1;
      const itemSteps = {
        "atk%": 3,
        "hp%": 3,
        "def%": 4.8,
        atk: 19,
        hp: 112,
        def: 15,
        "cr%": 2.4,
        "cd%": 4.8,
        pen: 9,
        ap: 9,
      };
      // 初期状態で1つのディスクを追加
      window.onload = function () {
        addItem();
      };

      function addItem() {
        if (itemCount >= maxItems) return;
        itemCount++;
        const itemContainer = document.getElementById("itemContainer");
        const newItem = document.createElement("div");
        newItem.classList.add("item-container");
        newItem.id = `item-${itemCount}`;
        newItem.innerHTML = `
                <label for="select${itemCount}">ディスク${itemCount} - メインステと値 </label>
                <select id="select${itemCount}">
                    <option value="atk%">攻撃%</option>
                    <option value="hp%">HP%</option>
                    <option value="def%">防御%</option>
                    <option value="atk">攻撃</option>
                    <option value="hp">HP</option>
                    <option value="def">防御</option>
                    <option value="cr%">会心率</option>
                    <option value="cd%">会心ダメ</option>
                    <option value="pen%">貫通率</option>
                    <option value="imp%">衝撃力</option>
                    <option value="physical%">物理ダメ</option>
                    <option value="fire%">炎ダメ</option>
                    <option value="ether%">エーテルダメ</option>
                    <option value="ice%">氷ダメ</option>
                    <option value="electric%">電気ダメ</option>
                    <option value="am%">異常掌握</option>
                    <option value="ap%">異常マスタリー</option>
                </select>

                <input type="number" id="number${itemCount}" class="number-input" min="1" max="2200" />

                <div id="inputContainer${itemCount}" class="input-section"></div>
                <div class="buttons">
                    <button id="minusButton${itemCount}" onclick="removeFields(${itemCount})" disabled>サブステ削除</button>
                    <button id="plusButton${itemCount}" onclick="addFields(${itemCount})">サブステ追加</button>
                </div>
            `;
        itemContainer.appendChild(newItem);
        addFields(itemCount);
        updateItemButtons();
      }

      function removeItem() {
        if (itemCount <= minItems) return;
        const itemContainer = document.getElementById("itemContainer");
        const lastItem = document.getElementById(`item-${itemCount}`);
        if (lastItem) {
          itemContainer.removeChild(lastItem);
          itemCount--;
        }
        updateItemButtons();
      }

      function addFields(itemId) {
        const inputContainer = document.getElementById(`inputContainer${itemId}`);
        const fieldSets = inputContainer.getElementsByClassName("field-set").length + 1;
        if (fieldSets > 4) return;
        const newSet = document.createElement("div");
        newSet.classList.add("field-set");
        newSet.id = `field-set-${itemId}-${fieldSets}`;
        newSet.innerHTML = `
        <label for="select${itemId}-${fieldSets}">サブステ${fieldSets} </label>
          <select id="select${itemId}-${fieldSets}" onchange="updateSlider(${itemId}, ${fieldSets})">
            <option value="atk%">攻撃%</option>
            <option value="hp%">HP%</option>
            <option value="def%">防御%</option>
            <option value="atk">攻撃</option>
            <option value="hp">HP</option>
            <option value="def">防御</option>
            <option value="cr%">会心率</option>
            <option value="cd%">会心ダメ</option>
            <option value="pen">貫通値</option>
            <option value="ap">異常マスタリー</option>
        </select>

        <div class="slider-container">
          <label for="slider${itemId}-${fieldSets}">値
            <span id="sliderValue${itemId}-${fieldSets}">3</span>
          </label>
          <input type="range" id="slider${itemId}-${fieldSets}" min="3" max="18" step="3" value="3" oninput="updateSliderValue(${itemId}, ${fieldSets})">
        </div>
            `;
        inputContainer.appendChild(newSet);
        updateFieldButtons(itemId);
      }

      function removeFields(itemId) {
        const inputContainer = document.getElementById(`inputContainer${itemId}`);
        const fieldSets = inputContainer.getElementsByClassName("field-set");
        if (fieldSets.length <= 1) return;
        const lastSet = fieldSets[fieldSets.length - 1];
        inputContainer.removeChild(lastSet);
        updateFieldButtons(itemId);
      }

      function updateSlider(itemId, fieldId) {
        const select = document.getElementById(`select${itemId}-${fieldId}`);
        const slider = document.getElementById(`slider${itemId}-${fieldId}`);
        const selectedOption = select.value;
        if (itemSteps[selectedOption]) {
          const step = itemSteps[selectedOption];
          slider.min = step;
          slider.max = Math.ceil(step * 60) / 10;
          slider.step = step;
          slider.value = step;
          document.getElementById(`sliderValue${itemId}-${fieldId}`).innerText = step;
        }
      }

      function updateSliderValue(itemId, fieldId) {
        const slider = document.getElementById(`slider${itemId}-${fieldId}`);
        const valueDisplay = document.getElementById(`sliderValue${itemId}-${fieldId}`);
        valueDisplay.innerText = slider.value;
      }

      function updateFieldButtons(itemId) {
        const inputContainer = document.getElementById(`inputContainer${itemId}`);
        const fieldSets = inputContainer.getElementsByClassName("field-set").length;
        const minusButton = document.getElementById(`minusButton${itemId}`);
        const plusButton = document.getElementById(`plusButton${itemId}`);
        minusButton.disabled = fieldSets <= 1;
        plusButton.disabled = fieldSets >= 4;
      }

      function updateItemButtons() {
        const removeItemButton = document.getElementById("removeItemButton");
        const addItemButton = document.getElementById("addItemButton");
        removeItemButton.disabled = itemCount <= minItems;
        addItemButton.disabled = itemCount >= maxItems;
      }

      function showResult() {
        const inputs = [];
        for (let i = 0; i <= 16; i++) {
          let val =
            document.getElementById(i.toString())?.value ??
            document.getElementById(i.toString())?.innerHTML;
          inputs.push(val);
        }
        let mains = [];
        let subs = [];
        for (let i = 1; i <= 6; i++) {
          let mainName = document.getElementById(`select${i}`)?.value; //main
          let mainVal = document.getElementById(`number${i}`)?.value; //main
          if (mainVal) {
            if (mainName.match("%"))
              mains.push(`${mainName.replace("%", "")} ${Number(mainVal).toFixed(1) + "%"}`);
            else mains.push(`${mainName} ${mainVal}`);
          }
          let subPerDisc = [];
          for (let j = 1; j <= 4; j++) {
            let subName = document.getElementById(`select${i}-${j}`)?.value; //subname
            let subVal = document.getElementById(`slider${i}-${j}`)?.value; //subval
            if (subName) {
              if (subName.match("%"))
                subPerDisc.push(`${subName.replace("%", "")} ${Number(subVal).toFixed(1) + "%"}`);
              else subPerDisc.push(`${subName} ${subVal}`);
            }
          }
          subs.push(subPerDisc);
        }
        console.log(mains);
        console.log(subs);
        const resultText = `{
  "detailedProps": ["hp ${inputs[10]}", "atk ${inputs[11]}", "def ${inputs[12]}","cr ${Number(
          inputs[13]
        ).toFixed(1)}%", "cd ${Number(inputs[14]).toFixed(1)}%", "pen ${Number(inputs[15]).toFixed(
          1
        )}%", "pen ${inputs[16]}"],
  "mainOps": ${JSON.stringify(mains)},
  "subOps": ${JSON.stringify(subs)},
  "setsString": "${inputs[7]}",
  "playerName": "${inputs[6]}",
  "IL": ${inputs[8]},
  "charName": "${inputs[0]}",
  "charLv": ${inputs[2]},
  "charTotsu": ${inputs[4]},
  "weaponName": "${inputs[1]}",
  "weaponLv": ${inputs[3]},
  "weaponTotsu": ${inputs[5]},
  "skillLvsStr": "非対応"
}`;
        document.getElementById("result").innerText = resultText.trim();
      }

      function copyResult() {
        const resultText = document.getElementById("result").innerText;
        navigator.clipboard
          .writeText(resultText)
          .then(() => {
            alert("結果がコピーされました");
          })
          .catch((err) => {
            alert("コピーに失敗しました: " + err);
          });
      }
    </script>
  </body>
</html>
